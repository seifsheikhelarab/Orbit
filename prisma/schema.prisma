generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
}

model User {
    id              String           @id @default(nanoid())
    email           String           @unique
    name            String
    password        String
    emailVerified   Boolean          @default(false)
    image           String?
    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
    sessions        Session[]
    accounts        Account[]
    jobApplications JobApplication[]

    @@map("user")
}

model Session {
    id        String   @id
    expiresAt DateTime
    token     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    ipAddress String?
    userAgent String?
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([token])
    @@index([userId])
    @@map("session")
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime  @default(now())
    updatedAt             DateTime  @updatedAt

    @@index([userId])
    @@map("account")
}

model Verification {
    id         String   @id
    identifier String
    value      String
    expiresAt  DateTime
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    @@index([identifier])
    @@map("verification")
}

enum locationType {
    remote
    hybrid
    onsite
}

enum applicationStatusType {
    saved
    applied
    interviewing
    offer
    rejected
}

enum jobType {
    fulltime
    parttime
    internship
}

enum priorityType {
    low
    medium
    high
}

enum roundType {
    phoneScreening
    hrInterview
    technical
    panelInterview
    finalRound
}

enum interviewType {
    online
    offline
}

enum resultType {
    pending
    passed
    failed
}

enum fileType {
    CV
    coverLetter
    portfolio
}

model JobApplication {
    id                String                @id @default(nanoid())
    userId            String
    companyName       String
    jobTitle          String
    jobType           jobType
    location          locationType
    createdAt         DateTime              @default(now())
    updatedAt         DateTime              @updatedAt
    source            String
    description       String?
    priority          priorityType
    jobURL            String
    salaryStart       Int?
    salaryEnd         Int?
    applicationStatus applicationStatusType @default(saved)

    user            User            @relation(fields: [userId], references: [id])
    statusHistories StatusHistory[]
    reminders       Reminder[]
    attachments     Attachment[]
}

model StatusHistory {
    id               String                @id @default(nanoid())
    jobApplicationId String
    status           applicationStatusType
    note             String
    createdAt        DateTime              @default(now())

    application JobApplication @relation(fields: [jobApplicationId], references: [id])
}

model Reminder {
    id               String        @id @default(nanoid())
    jobApplicationId String
    round            roundType
    scheduledAt      DateTime
    interviewType    interviewType
    location         String
    result           resultType
    notes            String
    createdAt        DateTime      @default(now())

    application JobApplication @relation(fields: [jobApplicationId], references: [id])
}

model Attachment {
    id               String         @id @default(nanoid())
    jobApplicationId String
    fileURL          String
    fileType         fileType
    fileName         String
    createdAt        DateTime       @default(now())
    jobapplication   JobApplication @relation(fields: [jobApplicationId], references: [id])
}
